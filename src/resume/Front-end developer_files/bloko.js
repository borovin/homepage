/**
* @preserve Copyright 2012 Twitter, Inc.
* @license http://www.apache.org/licenses/LICENSE-2.0.txt
*/
var Hogan={};(function(a,b){function i(a){return String(a===null||a===undefined?"":a)}function j(a){return a=i(a),h.test(a)?a.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&#39;").replace(g,"&quot;"):a}a.Template=function(a,c,d,e){this.r=a||this.r,this.c=d,this.options=e,this.text=c||"",this.buf=b?[]:""},a.Template.prototype={r:function(a,b,c){return""},v:j,t:i,render:function(b,c,d){return this.ri([b],c||{},d)},ri:function(a,b,c){return this.r(a,b,c)},rp:function(a,b,c,d){var e=c[a];return e?(this.c&&typeof e=="string"&&(e=this.c.compile(e,this.options)),e.ri(b,c,d)):""},rs:function(a,b,c){var d=a[a.length-1];if(!k(d)){c(a,b,this);return}for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return k(a)&&a.length===0?!1:(typeof a=="function"&&(a=this.ls(a,b,c,d,e,f,g)),h=a===""||!!a,!d&&h&&b&&b.push(typeof a=="object"?a:b[b.length-1]),h)},d:function(a,b,c,d){var e=a.split("."),f=this.f(e[0],b,c,d),g=null;if(a==="."&&k(b[b.length-2]))return b[b.length-1];for(var h=1;h<e.length;h++)f&&typeof f=="object"&&e[h]in f?(g=f,f=f[e[h]]):f="";return d&&!f?!1:(!d&&typeof f=="function"&&(b.push(g),f=this.lv(f,b,c),b.pop()),f)},f:function(a,b,c,d){var e=!1,f=null,g=!1;for(var h=b.length-1;h>=0;h--){f=b[h];if(f&&typeof f=="object"&&a in f){e=f[a],g=!0;break}}return g?(!d&&typeof e=="function"&&(e=this.lv(e,b,c)),e):d?!1:""},ho:function(a,b,c,d,e){var f=this.c,g=this.options;g.delimiters=e;var d=a.call(b,d);return d=d==null?String(d):d.toString(),this.b(f.compile(d,g).render(b,c)),!1},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ls:function(a,b,c,d,e,f,g){var h=b[b.length-1],i=null;if(!d&&this.c&&a.length>0)return this.ho(a,h,c,this.text.substring(e,f),g);i=a.call(h);if(typeof i=="function"){if(d)return!0;if(this.c)return this.ho(i,h,c,this.text.substring(e,f),g)}return i},lv:function(a,b,c){var d=b[b.length-1],e=a.call(d);if(typeof e=="function"){e=i(e.call(d));if(this.c&&~e.indexOf("{{"))return this.c.compile(e,this.options).render(d,c)}return i(e)}};var c=/&/g,d=/</g,e=/>/g,f=/\'/g,g=/\"/g,h=/[&<>\"\']/,k=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(a){function h(a){a.n.substr(a.n.length-1)==="}"&&(a.n=a.n.substring(0,a.n.length-1))}function i(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function j(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;d<e;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function k(a,b,c,d){var e=[],f=null,g=null;while(a.length>0){g=a.shift();if(g.tag=="#"||g.tag=="^"||l(g,d))c.push(g),g.nodes=k(a,g.tag,c,d),e.push(g);else{if(g.tag=="/"){if(c.length===0)throw new Error("Closing tag without opener: /"+g.n);f=c.pop();if(g.n!=f.n&&!m(g.n,f.n,d))throw new Error("Nesting error: "+f.n+" vs. "+g.n);return f.end=g.i,e}e.push(g)}}if(c.length>0)throw new Error("missing closing tag: "+c.pop().n);return e}function l(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].o==a.n)return a.tag="#",!0}function m(a,b,c){for(var d=0,e=c.length;d<e;d++)if(c[d].c==a&&c[d].o==b)return!0}function n(a){return a.replace(f,"\\\\").replace(c,'\\"').replace(d,"\\n").replace(e,"\\r")}function o(a){return~a.indexOf(".")?"d":"f"}function p(a){var b="";for(var c=0,d=a.length;c<d;c++){var e=a[c].tag;e=="#"?b+=q(a[c].nodes,a[c].n,o(a[c].n),a[c].i,a[c].end,a[c].otag+" "+a[c].ctag):e=="^"?b+=r(a[c].nodes,a[c].n,o(a[c].n)):e=="<"||e==">"?b+=s(a[c]):e=="{"||e=="&"?b+=t(a[c].n,o(a[c].n)):e=="\n"?b+=v('"\\n"'+(a.length-1==c?"":" + i")):e=="_v"?b+=u(a[c].n,o(a[c].n)):e===undefined&&(b+=v('"'+n(a[c])+'"'))}return b}function q(a,b,c,d,e,f){return"if(_.s(_."+c+'("'+n(b)+'",c,p,1),'+"c,p,0,"+d+","+e+',"'+f+'")){'+"_.rs(c,p,"+"function(c,p,_){"+p(a)+"});c.pop();}"}function r(a,b,c){return"if(!_.s(_."+c+'("'+n(b)+'",c,p,1),c,p,1,0,0,"")){'+p(a)+"};"}function s(a){return'_.b(_.rp("'+n(a.n)+'",c,p,"'+(a.indent||"")+'"));'}function t(a,b){return"_.b(_.t(_."+b+'("'+n(a)+'",c,p,0)));'}function u(a,b){return"_.b(_.v(_."+b+'("'+n(a)+'",c,p,0)));'}function v(a){return"_.b("+a+");"}var b=/\S/,c=/\"/g,d=/\n/g,e=/\r/g,f=/\\/g,g={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};a.scan=function(c,d){function w(){p.length>0&&(q.push(new String(p)),p="")}function x(){var a=!0;for(var c=t;c<q.length;c++){a=q[c].tag&&g[q[c].tag]<g._v||!q[c].tag&&q[c].match(b)===null;if(!a)return!1}return a}function y(a,b){w();if(a&&x())for(var c=t,d;c<q.length;c++)q[c].tag||((d=q[c+1])&&d.tag==">"&&(d.indent=q[c].toString()),q.splice(c,1));else b||q.push({tag:"\n"});r=!1,t=q.length}function z(a,b){var c="="+v,d=a.indexOf(c,b),e=i(a.substring(a.indexOf("=",b)+1,d)).split(" ");return u=e[0],v=e[1],d+c.length-1}var e=c.length,f=0,k=1,l=2,m=f,n=null,o=null,p="",q=[],r=!1,s=0,t=0,u="{{",v="}}";d&&(d=d.split(" "),u=d[0],v=d[1]);for(s=0;s<e;s++)m==f?j(u,c,s)?(--s,w(),m=k):c.charAt(s)=="\n"?y(r):p+=c.charAt(s):m==k?(s+=u.length-1,o=g[c.charAt(s+1)],n=o?c.charAt(s+1):"_v",n=="="?(s=z(c,s),m=f):(o&&s++,m=l),r=s):j(v,c,s)?(q.push({tag:n,n:i(p),otag:u,ctag:v,i:n=="/"?r-v.length:s+u.length}),p="",s+=v.length-1,m=f,n=="{"&&(v=="}}"?s++:h(q[q.length-1]))):p+=c.charAt(s);return y(r,!0),q},a.generate=function(b,c,d){var e='var _=this;_.b(i=i||"");'+p(b)+"return _.fl();";return d.asString?"function(c,p,i){"+e+";}":new a.Template(new Function("c","p","i",e),c,a,d)},a.parse=function(a,b,c){return c=c||{},k(a,"",[],c.sectionTags||[])},a.cache={},a.compile=function(a,b){b=b||{};var c=a+"||"+!!b.asString,d=this.cache[c];return d?d:(d=this.generate(this.parse(this.scan(a,b.delimiters),a,b),a,b),this.cache[c]=d)}}(typeof exports!="undefined"?exports:Hogan);
var HH=HH||{};HH.bloko=function($){"use strict";function extractParams(el){var func=el.onclick;return func?func():{}}function initBlock(el){var $el=$(el),domNode=$el.get(0);$.each(extractParams(domNode),function(blockName,params){$el[blockName](params)})}function initAllBlocks(el){$(el).find(".bloko").each(function(){initBlock(this)})}var CSS={ANIM_FADE:"g-anim-fade",ANIM_FADE_IN:"g-anim-fade_in",HIDDEN:"g-hidden"},MOUSE={BUTTON_LEFT:0,BUTTON_RIGHT:2},KEY={ARROW_UP:38,ARROW_DOWN:40,ENTER:13},DELIM={MOD:"_",ELEM:"__"},SUPPORT_TOUCH="ontouchstart"in window,EVENTS_TOUCH={click:SUPPORT_TOUCH?"touchstart":"click",mousedown:SUPPORT_TOUCH?"touchstart":"mousedown",mousemove:SUPPORT_TOUCH?"touchmove":"mousemove",mouseup:SUPPORT_TOUCH?"touchend":"mouseup"},validName="([a-z0-9][a-z0-9-]*)",rValidMod=new RegExp("(?:[a-z0-9]|^)"+DELIM.MOD+validName+DELIM.MOD+validName+"(?:$|"+DELIM.MOD+")","i");return $(initAllBlocks.bind(null,document)),{CSS:CSS,MOUSE:MOUSE,KEY:KEY,DELIM:DELIM,initBlock:initBlock,initAllBlocks:initAllBlocks,_create:function(type,element,options){this.type=type,this.$element=$(element),this.options=$.extend(Object.create($.fn[this.type].defaults),options),$.isFunction(this._init)&&this._init()},_makeModStr:function(name,value){return name?DELIM.MOD+name+DELIM.MOD+(value||""):""},_getNameOfElem:function(el){var classOfElem,cssClasses=this._getCssClassList($(el).first()),rValidElemName=new RegExp("^"+this.type+DELIM.ELEM+validName+"$","i");return classOfElem=cssClasses.filter(function(cssClassItem){return rValidElemName.test(cssClassItem)}.bind(this)),1===classOfElem.length?(classOfElem+="",classOfElem.slice(classOfElem.indexOf(DELIM.ELEM)+DELIM.ELEM.length)):void 0},_setOptions:function(options){return Object.keys(options).forEach(function(key){this._setOption(key,options[key])},this),this},_getOption:function(key){return $.isFunction(this.options[key])?this.options[key].call(this):this.options[key]},_getDefaultOption:function(key){var defaults=$.fn[this.type].defaults[key];return $.isFunction(defaults)?defaults.call(this):defaults},_getOptionAsBoolean:function(key){var option=this._getOption(key);return-1!==[!0,!1,"true","false"].indexOf(option)?"true"===String(option):this._getDefaultOption(key)},_getOptionAsNumber:function(key){var option=this._getOption(key);return $.isNumeric(option)?parseFloat(option):this._getDefaultOption(key)},_setOption:function(key,value){return this.options[key]=value,this},_isPassedOption:function(key){return this.options.hasOwnProperty(key)},_tmpl:function(templateName){var template,templateElemId;if(!templateName||"string"==typeof templateName&&templateName.length)return templateElemId="#bloko-tmpl-"+this.type+(templateName?"-"+templateName:""),this.templates=this.templates||{},template=this.templates[templateName]||Hogan.compile($(templateElemId).html())},_getMetrics:function(el){var $el=$(el),dimensions={width:$el.outerWidth(),height:$el.outerHeight()},offset=$.isWindow(el)?{left:$el.scrollLeft(),top:$el.scrollTop()}:$el.offset(),coords=$.extend({},offset,{right:offset.left+dimensions.width,bottom:offset.top+dimensions.height});return $.extend({},dimensions,coords)},_getViewportMetrics:function(){return this._getMetrics(window)},_fireEvent:function(eventName,eventData){this.$element.triggerHandler(eventName+"."+this.type,[eventData])},_getCssClassList:function(el){var attrClass;return attrClass=($(el).attr("class")||"").trim(),attrClass&&attrClass.split(" ")||[]},setMod:function(elems,modName,modValue){var $elems=$(elems),mods={};$elems.length&&("string"==typeof modName&&"string"==typeof modValue?mods[modName]=modValue:$.isPlainObject(modName)&&(mods=modName),$elems.each(function(index,elem){for(var key in mods){var value=mods[key],nameOfElem=this._getNameOfElem(elem),generatedModClass=this.type+(nameOfElem?DELIM.ELEM+nameOfElem:"");if(generatedModClass+=this._makeModStr(key,value),!rValidMod.test(generatedModClass)||this.getMod(elem,key)===value)return;this.removeMod(elem,key),$(elem).addClass(generatedModClass)}}.bind(this)))},getMod:function(el,modName){var cssClasses,extractedMod,$el=$(el).first();if($el.length&&modName&&"string"==typeof modName){cssClasses=this._getCssClassList($el);for(var i=0,len=cssClasses.length;len>i;i++)if(extractedMod=cssClasses[i].match(rValidMod),extractedMod&&extractedMod[1]===modName)return extractedMod[2]}},removeMod:function(elems,modName){function filterClassesWithMod(cssClasses){return cssClasses.filter(function(className){return-1===className.indexOf(modNameFragment)})}var modNameFragment=this._makeModStr(modName),$elems=$(elems);$elems.length&&modName&&"string"==typeof modName&&$elems.each(function(index,elem){$(elem).attr("class",filterClassesWithMod(this._getCssClassList(elem)).join(" "))}.bind(this))},utils:{addTouchSupport:function(eventName){return SUPPORT_TOUCH&&EVENTS_TOUCH[eventName]?EVENTS_TOUCH[eventName]:eventName}}}}(window.jQuery),function($){var testNode=document.createElement("input"),isInputSupported="oninput"in testNode&&(!("documentMode"in document)||document.documentMode>9),hasInputCapabilities=function(elem){return"INPUT"===elem.nodeName&&("text"===elem.type||"password"===elem.type)},activeElement=null,activeElementValue=null,activeElementValueProp=null,newValueProp={get:function(){return activeElementValueProp.get.call(this)},set:function(val){activeElementValue=val,activeElementValueProp.set.call(this,val)}},startWatching=function(target){activeElement=target,activeElementValue=target.value,activeElementValueProp=Object.getOwnPropertyDescriptor(target.constructor.prototype,"value"),Object.defineProperty(activeElement,"value",newValueProp),activeElement.attachEvent("onpropertychange",handlePropertyChange)},stopWatching=function(){activeElement&&(delete activeElement.value,activeElement.detachEvent("onpropertychange",handlePropertyChange),activeElement=null,activeElementValue=null,activeElementValueProp=null)},handlePropertyChange=function(nativeEvent){if("value"===nativeEvent.propertyName){var value=nativeEvent.srcElement.value;value!==activeElementValue&&(activeElementValue=value,$(activeElement).trigger("textchange"))}};isInputSupported?$(document).on("input",function(e){"TEXTAREA"!==e.target.nodeName&&$(e.target).trigger("textchange")}):$(document).on("focusin",function(e){hasInputCapabilities(e.target)&&(stopWatching(),startWatching(e.target))}).on("focusout",function(){stopWatching()}).on("selectionchange keyup keydown",function(){activeElement&&activeElement.value!==activeElementValue&&(activeElementValue=activeElement.value,$(activeElement).trigger("textchange"))})}(jQuery),function($,bloko){"use strict";var currentlyOpenBlock,isClickOnBlock,BLOCK_NAME="dropdown";$(document).on(bloko.utils.addTouchSupport("click"),function(event){event.button&&event.button!==bloko.MOUSE.BUTTON_LEFT||(currentlyOpenBlock&&!isClickOnBlock&&currentlyOpenBlock.hideOnOutsideClick(),isClickOnBlock=!1)});var Dropdown=function(element,options){this._create(BLOCK_NAME,element,options)};$.extend(Dropdown.prototype,bloko,{_init:function(){switch(this._getOption("action")){case"click":this.$element.on("click",function(event){event.preventDefault(),this.toggle()}.bind(this));break;case"manual":}},show:function(){return this._hasContent()?currentlyOpenBlock===this?(this.updatePosition(),void 0):(setTimeout(function(){currentlyOpenBlock&&currentlyOpenBlock.hide(),currentlyOpenBlock=this,this.$block=$(this._tmpl().render()).remove().css({left:-1e4,top:-1e4,display:"block"}).appendTo(document.body),this._setContent(),this.updatePosition(),this.$block.on(bloko.utils.addTouchSupport("click"),function(){isClickOnBlock=!0}).on("click",'[data-attach="'+BLOCK_NAME+'-hide"]',function(){return this.hide(),!1}.bind(this)),this._fireEvent("showed")}.bind(this),0),void 0):void 0},hide:function(){if(currentlyOpenBlock===this){this.$block.removeClass(bloko.CSS.ANIM_FADE_IN);var removeBlock=function(){var $content=this._getContent();$content.addClass(bloko.CSS.HIDDEN),document.body.insertBefore($content[0],null),this.$block.remove(),currentlyOpenBlock=void 0,this._fireEvent("hid")}.bind(this);$.support.transition&&this.$block.hasClass(bloko.CSS.ANIM_FADE)?this.$block.one($.support.transition.end,function(){removeBlock()}):removeBlock()}},hideOnOutsideClick:function(){this._getOptionAsBoolean("hideonclick")&&this.hide()},toggle:function(){this[this._isVisible()?"hide":"show"]()},_hasContent:function(){return!!this._getContent()},_setContent:function(){var placeForContent=this.$block.find('[data-attach="'+BLOCK_NAME+'-content"]')[0],$content=this._getContent();placeForContent.innerHTML="",placeForContent.insertBefore($content[0],null),$content.removeClass(bloko.CSS.HIDDEN),this._getOptionAsBoolean("nopaddings")&&$(placeForContent).addClass(BLOCK_NAME+"__content_paddings_no")},_getContent:function(){return this.$content||(this.$content=this.$element.find(this._getOption("content")))},_calcPosition:function(options){var elementMetrics,blockMetrics,coords={};switch(elementMetrics=this._getElementMetrics(),blockMetrics=this._getBlockMetrics(),options.placement){case"top":coords.top=elementMetrics.top-blockMetrics.height;break;case"bottom":coords.top=elementMetrics.top+elementMetrics.height;break;case"left":coords.left=elementMetrics.left-blockMetrics.width;break;case"right":coords.left=elementMetrics.left+elementMetrics.width}if("top"===options.placement||"bottom"===options.placement)switch(options.align){case"left":coords.left=elementMetrics.left;break;case"right":coords.left=elementMetrics.left+elementMetrics.width-blockMetrics.width;break;default:coords.left=elementMetrics.left+elementMetrics.width/2-blockMetrics.width/2}if("left"===options.placement||"right"===options.placement)switch(options.valign){case"top":coords.top=elementMetrics.top;break;case"bottom":coords.top=elementMetrics.top+elementMetrics.height-blockMetrics.height;break;default:coords.top=elementMetrics.top+elementMetrics.height/2-blockMetrics.height/2}return coords},updatePosition:function(){var opts={placement:this._getOption("placement"),align:this._getOption("align"),valign:this._getOption("valign")};this._getOptionAsBoolean("autocorrection")&&$.extend(opts,this._autoCorrectPlacement(opts)),opts.coords=this._calcPosition({placement:opts.placement,align:opts.align,valign:opts.valign}),this.removeMod(this.$block,"align"),this.removeMod(this.$block,"placement"),this.removeMod(this.$block,"valign"),"top"===opts.placement||"bottom"===opts.placement?this.setMod(this.$block,{placement:opts.placement,align:opts.align}):this.setMod(this.$block,{placement:opts.placement,valign:opts.valign}),this.$block.css(opts.coords).addClass(bloko.CSS.ANIM_FADE_IN)},_getElementMetrics:function(){return this._getMetrics(this.$element)},_getBlockMetrics:function(){return this._getMetrics(this.$block)},_isCoordsInViewport:function(x,y){var viewport,coords;if(arguments.length&&!(arguments.length>2)&&(1===arguments.length&&$.isPlainObject(x)&&(coords=x,x=coords.left,y=coords.top),$.isNumeric(x)||$.isNumeric(y)))return viewport=this._getViewportMetrics(),x=$.isNumeric(x)?x:viewport.left,y=$.isNumeric(y)?y:viewport.top,x<viewport.left||x>viewport.right||y<viewport.top||y>viewport.bottom?!1:!0},_isBlockInViewport:function(coords){var blockMetrics=this._getBlockMetrics(),rectStart={left:$.isNumeric(coords.left)?coords.left:blockMetrics.left,top:$.isNumeric(coords.top)?coords.top:blockMetrics.top},rectEnd={left:rectStart.left+blockMetrics.width,top:rectStart.top+blockMetrics.height};return this._isCoordsInViewport(rectStart)&&this._isCoordsInViewport(rectEnd)},_autoCorrectPlacement:function(options){var placementFound,coords,newOptions={};if(coords=this._calcPosition(options),!this._isBlockInViewport(coords)){var optionNames={top:"align",bottom:"align",right:"valign",left:"valign"},choices={align:["center","left","right"],valign:["middle","top","bottom"]};return placementFound=["top","right","bottom","left"].some(function(placement){var optionName=optionNames[placement];return choices[optionName].some(function(optionValue){return newOptions={placement:placement},newOptions[optionName]=optionValue,this._isBlockInViewport(this._calcPosition(newOptions))},this)},this),placementFound?$.extend({},options,newOptions):void 0}},_isVisible:function(){return this.$block&&this.$block.is(":visible")}}),$.fn[BLOCK_NAME]=function(method){var options=arguments;return this.each(function(){var outgoingArgs,$this=$(this),block=$this.data(BLOCK_NAME);return block?method&&"string"==typeof method?("_"===method[0]&&console.error(BLOCK_NAME+": you tried to call the protected method"),outgoingArgs=options.length>1?[].slice.call(options,1):[],method in block?block[method].apply(block,outgoingArgs):console.error(BLOCK_NAME+": doesn't have method \""+method+'"'),void 0):(console.warn(BLOCK_NAME+": already initialized"),void 0):(options.length>1&&console.warn(BLOCK_NAME+": you passed too many arguments for initializing, needed only one"),options.length&&!$.isPlainObject(options[0])?(console.error(BLOCK_NAME+': the type of parameter you passed is "'+$.type(options[0])+'", but expected "object"'),void 0):(block=new Dropdown(this,options[0]),$this.data(BLOCK_NAME,block),void 0))})},$.fn[BLOCK_NAME].Constructor=Dropdown,$.fn[BLOCK_NAME].defaults={content:'[data-attach="'+BLOCK_NAME+'-content-placeholder"]',placement:"bottom",align:"center",valign:"middle",action:"click",autocorrection:!0,hideonclick:!0,nopaddings:!1,animation:!0}}(window.jQuery,HH.bloko),function($,bloko){"use strict";var inputValue,prevInputValue,onInputTimer,prevReceivedDataJSON,isSelectedDirectly,BLOCK_NAME="suggest",customRightPadding=23,Suggest=function(element,options){this._create(BLOCK_NAME,element,options)};$.extend(Suggest.prototype,bloko,{_init:function(){var hiddenFieldName=this._getOption("hidden");this.$input=this.$element,hiddenFieldName&&(this.$hidden=this.$input.next().attr("name")===hiddenFieldName?this.$input.next():$("<input>",{type:"hidden",name:hiddenFieldName,value:""}).insertAfter(this.$input),this.$hidden.val(this._getOption("hiddenValue"))),"string"==typeof this._getOption("template")&&$(this._getOption("template")).length&&(this.suggestionTemplate=$(this._getOption("template")).html()),this._addEventListeners()},_addEventListeners:function(){this.$input.on("focus",function(){!prevReceivedDataJSON||this.$input.val().trim().length<2||this._showDropdown()}.bind(this)).on("textchange",this._onTypeInInput.bind(this)).on("blur",function(){setTimeout(this._onLostFocus.bind(this),0)}.bind(this)).on("keydown",this._keyboardControl.bind(this))},_onTypeInInput:function(){var currentInputValue=this.$input.val().trim().toUpperCase();currentInputValue!==prevInputValue&&(prevInputValue=currentInputValue,this.$hidden&&this.$hidden.val(""),this._fireEvent("unselected"),clearTimeout(onInputTimer),onInputTimer=setTimeout(this._onChangeInputValue.bind(this),this._getOption("throttle")))},_onLostFocus:function(){var $items;isSelectedDirectly||this._getDropdown().is(":hidden")||(this._getOptionAsBoolean("selectonblur")&&($items=$("."+this.type+bloko.DELIM.ELEM+"item",this._getDropdown()),$items.length&&this._directSelectItem(this._getDatum($items.first()))),this._hideDropdown())},_getHighlightedItem:function(){return this._getDropdown().find("."+this.type+bloko.DELIM.ELEM+"item_state_highlighted")},_highlightItem:function(index){var $items=$("."+this.type+bloko.DELIM.ELEM+"item",this._getDropdown());index="number"==typeof index?index<$items.length?index:0:0,this.removeMod($items,"state"),this.setMod($items.get(index),"state","highlighted")},_keyboardControl:function(event){var $highlightedItem=this._getHighlightedItem(),highlitedItemIndex=$highlightedItem.index();if($highlightedItem.length){switch(this._enableKeyboardMode(),event.keyCode){case bloko.KEY.ARROW_UP:highlitedItemIndex--;break;case bloko.KEY.ARROW_DOWN:highlitedItemIndex++;break;case bloko.KEY.ENTER:return event.preventDefault(),this.setMod($highlightedItem,"state","selected"),this._directSelectItem(this._getDatum($highlightedItem)),void 0;default:return}this._highlightItem(highlitedItemIndex)}},_getDropdown:function(){function createDropdown(){return $(this._tmpl("dropdown").render()).on(bloko.utils.addTouchSupport("mousemove"),this._enableMouseMode.bind(this)).on(bloko.utils.addTouchSupport("mousedown"),"."+this.type+bloko.DELIM.ELEM+"item",this._onClickItem.bind(this))}return this.$dropdown||(this.$dropdown=createDropdown.bind(this)())},_clearResults:function(){this.suggestItems={},prevReceivedDataJSON=null,this._getDropdown().html("")},_enableKeyboardMode:function(){var $suggestionsList=this._getDropdown().find("."+this.type+bloko.DELIM.ELEM+"items");"disabled"!==this.getMod($suggestionsList,"hover")&&this.setMod($suggestionsList,"hover","disabled")},_enableMouseMode:function(){var $suggestionsList=this._getDropdown().find("."+this.type+bloko.DELIM.ELEM+"items");"enabled"!==this.getMod($suggestionsList,"hover")&&(this.setMod($suggestionsList,"hover","enabled"),this.removeMod($suggestionsList.find("."+this.type+bloko.DELIM.ELEM+"item"),"state"))},_onClickItem:function(event){this._directSelectItem(this._getDatum(event.currentTarget)),event.preventDefault()},_onChangeInputValue:function(){var inputValue=this.$input.val().trim(),wildcard=this._getOption("wildcard"),url=this._getOption("remote").replace(wildcard,encodeURIComponent(inputValue)).replace("&amp;","&");return inputValue.length<2?(this._hideDropdown(),void 0):($.getJSON(url).done(this._onReceivedDataSuccess.bind(this)).fail(this._onReceivedDataError.bind(this)),void 0)},_onReceivedDataSuccess:function(suggestData){function isValidDataObj(obj){return $.isPlainObject(obj)&&$.isArray(obj.items)&&obj.items.length}var itemsLimit,items;return isValidDataObj(suggestData)?(items=suggestData.items,itemsLimit=this._getOptionAsNumber("limit"),items.length>itemsLimit&&(suggestData.items=items=items.slice(0,itemsLimit)),items.map(function(datum,index){return datum.datumId=index,datum}),this._getOptionAsBoolean("autoselect")&&1===items.length&&items[0].text.toUpperCase()===inputValue.toUpperCase()?(this._autoSelectItem(items[0]),void 0):JSON.stringify(suggestData)===prevReceivedDataJSON?(this._showDropdown(),void 0):(prevReceivedDataJSON=JSON.stringify(suggestData),this.suggestItems=items,suggestData.delimiter=this._getOptionAsBoolean("delimiter"),this._getDropdown().html(this._renderItems(suggestData)),$("."+this.type+bloko.DELIM.ELEM+"item",this._getDropdown()).hover(function(event){this.setMod(event.currentTarget,"state","highlighted")}.bind(this),function(event){this.removeMod(event.currentTarget,"state")}.bind(this)),this._highlightItem(),this._showDropdown(),void 0)):(this.$element.one("hid."+this.type,this._clearResults.bind(this)),this._hideDropdown(),void 0)},_onReceivedDataError:function(){this._clearResults(),console.error(BLOCK_NAME+": Ajax error")},_renderItems:function(dataJSON){var itemTemplate={item:this.suggestionTemplate||this._tmpl("item")};return $(this._tmpl("items").render(dataJSON,itemTemplate))},_showDropdown:function(){var inputMetrics;this._getDropdown().is(":visible")||(this._getDropdown().detach().addClass($.support.transition?bloko.CSS.ANIM_FADE:"").appendTo(document.body),inputMetrics=this._getMetrics(this.$input),this._getDropdown().css({left:inputMetrics.left,top:inputMetrics.top+inputMetrics.height,width:inputMetrics.width+customRightPadding}),$.support.transition&&setTimeout(function(){this._getDropdown().addClass(bloko.CSS.ANIM_FADE_IN)}.bind(this),0),this._fireEvent("showed"))},_hideDropdown:function(){if(!this._getDropdown().is(":hidden")){var removeDropdown=function(){this._getDropdown().detach(),this._fireEvent("hid"),isSelectedDirectly=void 0}.bind(this);$.support.transition&&this._getDropdown().hasClass(bloko.CSS.ANIM_FADE)?this._getDropdown().one($.support.transition.end,removeDropdown):removeDropdown(),this._getDropdown().removeClass(bloko.CSS.ANIM_FADE_IN)}},_getDatum:function(elem){return this.suggestItems[$(elem).data("datum-id")]},_selectItem:function(datum){setTimeout(this._hideDropdown.bind(this),120),$.isPlainObject(datum)&&(prevReceivedDataJSON=null,this.$hidden&&this.$hidden.val(datum.id))},_directSelectItem:function(datum){isSelectedDirectly=!0,this._selectItem(datum),this.$input.val(datum.text),this._fireEvent("selected",datum)},_autoSelectItem:function(datum){this._selectItem(datum),this._fireEvent("autoselected",datum)}}),$.fn[BLOCK_NAME]=function(method){var options=arguments;return this.each(function(){var outgoingArgs,$this=$(this),block=$this.data(BLOCK_NAME);if(!block)return options.length>1?(console.error(BLOCK_NAME+": expected one parameter, and you passed "+options.length),void 0):$.isPlainObject(options[0])?"string"!=typeof options[0].remote?(console.error(BLOCK_NAME+': not passed the required parameter "remote" or its type is not a string'),void 0):(block=new Suggest(this,options[0]),$this.data(BLOCK_NAME,block),void 0):(console.error(BLOCK_NAME+': the type of parameter you passed is "'+$.type(options[0])+'", but expected "object"'),void 0);if(!method||"string"!=typeof method)return console.warn(BLOCK_NAME+": already initialized"),void 0;"_"===method[0]&&console.error(BLOCK_NAME+": you tried to call the protected method"),outgoingArgs=options.length>1?[].slice.call(options,1):[];try{block[method].apply(block,outgoingArgs)}catch(error){console.error(BLOCK_NAME+": doesn't have method \""+method+'"'),console.error("%s: %s",error.name,error.message)}})},$.fn[BLOCK_NAME].Constructor=Suggest,$.fn[BLOCK_NAME].defaults={limit:10,wildcard:"%QUERY%",throttle:300,autoselect:!1,selectonblur:!0,delimiter:!1}}(window.jQuery,HH.bloko);