//201403151543

(function(b){b.fn.vishnu=function(a){if("string"===typeof a&&!b.fn.vishnu.methods[a]||!a||"object"===typeof a)return b.fn.vishnu.methods.init.apply(this,arguments);if(b.fn.vishnu.methods[a])return b.fn.vishnu.methods[a].apply(this,Array.prototype.slice.call(arguments,1));b.error("\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "+a+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442")};b.fn.vishnu.settings={"default":{debugMode:!1,Tracker:{},Model:{},
View:{},Cookie:{},Net:{Socket:{}},Rate:{enabled:!1},History:{enabled:!1}}};b.fn.vishnu.methods={init:function(a){return this.each(function(){var d=b(this);if(!d.data("vishnu")){var c=new b.fn.vishnu.Vishnu(d);c.init(a);b(this).data("vishnu",{target:d,vishnu:c})}})},show:function(){return this.each(function(){var a=b(this).data("vishnu");a&&a.vishnu&&a.vishnu.show()})},hide:function(){return this.each(function(){var a=b(this).data("vishnu");a&&a.vishnu&&a.vishnu.hide()})},action:function(a){return this.each(function(){var d=
b(this).data("vishnu");d&&d.vishnu&&d.vishnu.action(a)})},destroy:function(){return this.each(function(){var a=b(this),d=a.data("vishnu");d&&d.vishnu&&(b(d.vishnu.Target).unbind(),b(d.vishnu.Target).html(""));a.removeData("vishnu")})}};b.fn.vishnu.instancesCount=0;b.fn.vishnu.VishnuEvent={INIT:"init",SHOW:"show",HIDE:"hide",DRAW:"draw",RESPONSE:"response",INACTIVE:"inactive",CLICK:"click",MOUSE_MOVE:"mouse-move",ACTION:"action",RATE:"rate",RATING_SENT:"rating-sent",USER_ACTIVITY:"user-activity",RATING_RESPONSE:"rating-response",
REQUEST:"request",LINK_CLICK:"link-click",HISTORY_LOADED:"history_loaded"};b.fn.vishnu.Vishnu=function(a){this.Target=a;this.number=++b.fn.vishnu.instancesCount};b.fn.vishnu.Vishnu.prototype={number:null,Target:null,Tracker:null,Model:null,View:null,Net:null,Cookie:null,History:null,debugMode:!1,init:function(a){var d=null;"string"===typeof a&&36===a.length?d=a:"object"===typeof a&&a.Model&&a.Model.uuid?d=a.Model.uuid:b.fn.vishnu.uuid&&(d=b.fn.vishnu.uuid);if(d){var c=this.mergeSettings(b.fn.vishnu.settings["default"],
b.fn.vishnu.settings[d]?b.fn.vishnu.settings[d]:{});"object"===typeof a&&(c=this.mergeSettings(c,a));c.Model.uuid||(c.Model.uuid=d);this.debugMode=c.debugMode;this.getCookie().init(c.Cookie);this.getTracker().init(c.Tracker);this.factoryNet(c.Net);this.getView().init(c.View);this.getModel().init(c.Model);c.Rate.enabled&&this.getRate().init(c.Rate);c.History.enabled&&this.getHistory().init(c.History);this.getView().draw()}},factoryNet:function(a){switch(a.type){case b.fn.vishnu.ConnectionType.SYNC:this.Net=
b.extend({},b.fn.vishnu.SyncConnect);break;case b.fn.vishnu.ConnectionType.ASYNC:this.Net=b.extend({},b.fn.vishnu.AsyncConnect)}this.Net.init(a)},mergeSettings:function(a,d){return b.extend(!0,{},a,d)},show:function(){this.View&&this.View.showVishnu()},hide:function(){this.View&&this.View.hideVishnu()},action:function(a){this.Model&&this.Model.sendUserAction(a)},getTracker:function(){this.Tracker||(this.Tracker=new b.fn.vishnu.Tracker(this));return this.Tracker},getModel:function(){this.Model||(this.Model=
new b.fn.vishnu.Model(this));return this.Model},getView:function(){this.View||(this.View=new b.fn.vishnu.View(this));return this.View},getNet:function(){this.Net||(this.Net=new b.fn.vishnu.Net(this));return this.Net},getCookie:function(){this.Cookie||(this.Cookie=new b.fn.vishnu.Cookie(this));return this.Cookie},getRate:function(){this.Rate||(this.Rate=new b.fn.vishnu.Rate(this));return this.Rate},getHistory:function(){this.History||(this.History=new b.fn.vishnu.History(this));return this.History},
track:function(a){this.Tracker.track(a)},log:function(a){this.debugMode&&console&&console.log&&console.log(a)},on:function(a,b){if(this.Target)this.Target.on(a,b)},trigger:function(a,b){this.Target&&(this.log("EVENT: "+a,b),this.Target.trigger(a,b))}};b.fn.vishnu.Tracker=function(a){this.prefix="vishnu"+a.number+"."};b.fn.vishnu.Tracker.prototype={account:!1,prefix:"",_ready:!1,init:function(a){for(var b in a)b in this&&(this[b]=a[b]);this.account&&this.account.toString().length&&("undefined"===typeof _gat&&
"undefined"===typeof _gaq&&(a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)),_gaq="undefined"!==typeof _gaq?_gaq:[],this._ready=!0,this.track(["_setAccount",this.account]),this.postInit(),this.track(["_trackPageview"]))},postInit:function(){this.track(["_setAllowLinker",!0])},track:function(a){if(this._ready){if("object"===
typeof a&&"_trackEvent"===a[0])for(var b=a.length;5>=b;b++)5>b?a[b]=null:5==b&&(a[b]=!0);this.prefix&&"object"===typeof a&&"string"===typeof a[0]&&(a[0]=this.prefix+a[0]);_gaq.push(a)}}};b.fn.vishnu.Cookie=function(a){this.prefix="vishnu"+a.number+".";this.domain||(a=document.domain.split("."),2<a.length&&a.shift(),this.domain=a.join("."))};b.fn.vishnu.Cookie.prototype={prefix:"",domain:null,init:function(a){for(var b in a)b in this&&(this[b]=a[b])},getCookie:function(a){a=this.prefix+a+"=";for(var b=
document.cookie.split(";"),c=0;c<b.length;c++){for(var e=b[c];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a))return e.substring(a.length,e.length)}return null},setCookie:function(a,b,c){var e="";c&&(e=new Date,e.setTime(e.getTime()+864E5*c),e="; expires="+e.toGMTString());c=this.domain.split(".");2<c.length&&c.shift();document.cookie=this.prefix+a+"="+b+e+"; path=/; domain=."+this.domain},hasCookie:function(a){return 0<=document.cookie.indexOf(this.prefix+a+"=")}};b.fn.vishnu.ConnectionType=
{SYNC:"sync",ASYNC:"async"};b.fn.vishnu.Net=function(){};b.fn.vishnu.Net.prototype={type:b.fn.vishnu.ConnectionType.SYNC,_handlerInit:null,_handlerResponse:null,_handlerEvent:null,_handlerRate:null,init:function(a){for(var b in a)b in this&&(this[b]=a[b])},onInit:function(a){this._handlerInit=a},onResponse:function(a){this._handlerResponse=a},onEvent:function(a){this._handlerEvent=a},onRate:function(a){this._handlerRate=a},sendInit:function(a,b){},sendRequest:function(a,b,c){},sendEvent:function(a,
b,c,e){},sendClick:function(a,b,c){},sendRate:function(a,b,c){}};b.fn.vishnu.SyncConnect={url:"https://biz.nanosemantics.ru/api/2.1/json/",init:function(a){for(var b in a)b in this&&(this[b]=a[b])},sendInit:function(a,b){var c=a;b&&(c+="/"+b);var e=this;this.send("Chat.init",c,function(a){a=a&&a.result?a.result:a;e._handlerInit(a)})},sendRequest:function(a,b,c){var e=this;this.send("Chat.request",[b,c],function(a){a=a&&a.result?a.result:a;e._handlerResponse(a)})},sendEvent:function(a,b,c,e){var u=
this;this.send("Chat.event",[b,c,e],function(a){a=a&&a.result?a.result:a;u._handlerEvent(a)})},sendClick:function(a,b,c){this.send("Chat.click",[b,c],function(){})},sendRate:function(a,b,c){var e=this;this.send("Chat.rate",[b,c],function(a){a=a&&a.result?a.result:a;e._handlerRate(a)})},send:function(a,d,c){var e=this.url+a,e="Chat.init"===a?e+("/"+d):e+("/"+encodeURIComponent(b.fn.vishnu.JSON.stringify(d)));b.ajax({type:"GET",url:e,dataType:"jsonp",success:c})}};b.fn.vishnu.SyncConnect=b.extend({},
new b.fn.vishnu.Net,b.fn.vishnu.SyncConnect);b.fn.vishnu.AsyncConnect={_socket:null,init:function(a){for(var d in a)d in this&&(this[d]=a[d]);var c=this;this._socket=new b.fn.vishnu.Socket;this._socket.init(a.Socket);this._socket.on("init",function(a){a=b.parseJSON(a);c._handlerInit(a)});this._socket.on("request",function(a){a=b.parseJSON(a);c._handlerResponse(a)});this._socket.on("event",function(a){a=b.parseJSON(a);c._handlerEvent(a)});this._socket.on("rate",function(a){a=b.parseJSON(a);c._handlerRate(a)})},
sendInit:function(a,b){this._socket.emit("chatInit",{request:{uuid:a,cuid:b,hash:""}})},sendRequest:function(a,b,c){this._socket.send({request:{uuid:a,cuid:b,text:c}})},sendEvent:function(a,b,c,e){this._socket.emit("chatEvent",{request:{uuid:a,cuid:b,euid:c,context:e}})},sendClick:function(a,b,c){this._socket.emit("chatClick",{request:{uuid:a,cuid:b,token:c}})},sendRate:function(a,b,c){this._socket.emit("chatRate",{request:{uuid:a,cuid:b,rating:c}})}};b.fn.vishnu.AsyncConnect=b.extend({},new b.fn.vishnu.Net,
b.fn.vishnu.AsyncConnect);b.fn.vishnu.Socket=function(){};b.fn.vishnu.Socket.prototype={host:null,port:8001,scriptLocation:"./socket.io.js",swfLocation:"./WebSocketMain.swf",userHash:"",connect:null,isReady:!1,isConnected:!1,onReadyQueue:[],onConnectQueue:[],init:function(a){for(var b in a)b in this&&(this[b]=a[b]);"undefined"===typeof io&&(a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=this.scriptLocation,b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,
b));this._init()},_init:function(){if("undefined"===typeof io){var a=this;setTimeout(function(){a._init()},500)}else{WEB_SOCKET_SWF_LOCATION=this.swfLocation;this.host||(this.host=location.protocol+"//"+location.hostname);this.connect=new io.connect(this.host,{port:this.port,rememberTransport:!1});a=this;this.connect.on("connect",function(){a.isConnected=!0;for(var b=null;b=a.onConnectQueue.shift();){var d=b.shift();a[d].apply(a,b)}});this.isReady=!0;for(var b=null;b=this.onReadyQueue.shift();)this[b.shift()].apply(this,
b)}},on:function(a,b){if(this.isReady)this.connect.on(a,b);else this.onReadyQueue.push(["on",a,b])},once:function(a,b){if(this.isReady)this.connect.once(a,b);else this.onReadyQueue.push(["once",a,b])},emit:function(a,d){d.request.userHash=this.userHash;this.isConnected?this.connect.emit(a,b.fn.vishnu.JSON.stringify(d)):this.onConnectQueue.push(["emit",a,d])},send:function(a){a.request.userHash=this.userHash;this.isConnected?this.connect.send(b.fn.vishnu.JSON.stringify(a)):this.onConnectQueue.push(["send",
a])}};b.fn.vishnu.JSON={stringify:function(a){if("object"===typeof window.JSON&&"function"===typeof window.JSON.stringify)return window.JSON.stringify(a);a=this._objectToJson(a);a=a.replace(/\t/g,"\\t");a=a.replace(/\n/g,"\\n");return a=a.replace(/\r/g,"\\r")},_arrayToJson:function(a){var b,c="[";for(b in a)"string"===typeof a[b]?c+='"'+a[b].split('"').join('\\"')+'",':null===a[b]?c+="null,":"object"===typeof a[b]&&null!==a[b]?c+=this._objectToJson(a[b])+",":!isNaN(parseFloat(a[b]))&&isFinite(a[b])&&
(c+=a[b]+",");","===c.charAt(c.length-1)&&(c=c.substr(0,c.length-1));return c+"]"},_objectToJson:function(a){var b,c=!0,e="{";for(b in a)if(isNaN(b)){c=!1;break}if(c)return this._arrayToJson(a);for(b in a)"string"===typeof a[b]?e+='"'+b+'":"'+a[b]+'",':"object"===typeof a[b]?e+='"'+b+'":'+this._objectToJson(a[b])+",":!isNaN(parseFloat(a[b]))&&isFinite(a[b])&&(e+='"'+b+'":'+a[b]+",");","===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1));return e+"}"}};b.fn.vishnu.Event=function(){this.Counter={};
this.Counter[this.INACTIVE]=0;this.Counter[this.CLICK]=0;this.Counter[this.MOUSE]=0};b.fn.vishnu.Event.prototype={READY:"00b2fcbe-f27f-437b-a0d5-91072d840ed3",MOUSE:"6819087d-a7d0-4c67-acd4-47d40b233cc9",INACTIVE:"29e75851-6cae-44f4-8a9c-f6489c4dca88",CLICK:"d825476d-bc08-4038-9ecf-e6b2b267c7b8",ACTION:"132d778f-099b-4fbe-a765-4014136ee970",Counter:null,timer:0,callbackInactive:null,timeout:0,reset:function(a){this.Counter[a]=0},initInactiveTimer:function(a,b){a&&(this.callbackInactive=a);b&&(this.timeout=
b);var c=this;window.setInterval(function(){c._incTimer()},1E3)},clearInactiveTimer:function(){this.timer=0},_incTimer:function(){this.timer++;"function"===typeof this.callbackInactive&&this.timeout&&1E3*this.timer>=this.timeout&&this.callbackInactive()}};b.fn.vishnu.Model=function(a){this.Vishnu=a};b.fn.vishnu.Model.prototype={Vishnu:null,Cookie:null,Net:null,History:null,Event:null,uuid:"",cuid:"",params:null,initData:null,firstRequest:!0,initAlreadySended:!1,init:function(a){for(var d in a)d in
this&&(this[d]=a[d]);this.Cookie||(this.Cookie=this.Vishnu.getCookie());this.Net||(this.Net=this.Vishnu.getNet());this.History||(this.History=this.Vishnu.getHistory());this.Event||(this.Event=new b.fn.vishnu.Event);var c=this;this.Net.onInit(function(a){c.onInit(a)});this.Net.onResponse(function(a){c.onResponse(a)});this.Net.onEvent(function(a){c.onEventResponse(a)});this.Net.onRate(function(a){c.onRateResponse(a)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.REQUEST,function(a,b){c.sendRequest(b)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.LINK_CLICK,
function(a,b){c.sendClick(b)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.SHOW,function(a){c.initAlreadySended||(c.Net.sendInit(c.getUUID(),c.getCUID()),c.initAlreadySended=!0)})},onInit:function(a){a&&a.cuid?(this.initData=a,this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.INIT,a),this.getCUID()!==a.cuid&&this.Cookie.setCookie("new_chat",1,365),this.setCUID(a.cuid),this.initEvents(),this.sendEvent(this.Event.READY,this.params?this.params:null),this.Vishnu.track(["_trackEvent","Inf","Load"])):(this.Vishnu.track(["_trackEvent",
"Error","Init"]),this.Vishnu.log("Empty CUID"))},getUUID:function(){return this.uuid},getCUID:function(){this.cuid||(this.cuid=this.Cookie.getCookie("cuid"));return this.cuid},setCUID:function(a){this.Cookie.setCookie("cuid",a,365);this.cuid=a},initEvents:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.INACTIVE]&&this.initData.events[this.Event.INACTIVE].enabled){var a=this;this.Event.initInactiveTimer(function(){a.eventInactive()},this.initData.events[this.Event.INACTIVE].timeout)}else this.Event.initInactiveTimer()},
sendEvent:function(a,b){this.Net.sendEvent(this.getUUID(),this.getCUID(),a,b);this.Event.READY!==a&&this.Vishnu.track(["_trackEvent","Inf","Event"])},sendRequest:function(a){this.Event.clearInactiveTimer();this.Net.sendRequest(this.getUUID(),this.getCUID(),a);this.Vishnu.track(["_trackEvent","Inf","Request"])},onEventResponse:function(a){return this.onResponse(a,!0)},onRateResponse:function(a){this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.RATING_RESPONSE,a)},onResponse:function(a,d){a?(d="undefined"===
typeof d?!1:d,this.firstRequest&&!d&&(this.firstRequest=!1,this.Cookie.getCookie("new_chat")&&(this.Cookie.setCookie("new_chat","",-1),this.Cookie.setCookie("chat_link","",-1),this.Cookie.setCookie("chat_click","",-1),this.Vishnu.track(["_trackEvent","Inf","Chat"]))),a.isEvent=d,this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.RESPONSE,a)):this.Vishnu.track(["_trackEvent","Error","Bad response"])},sendClick:function(a){a=[this.getCUID(),a];this.Net.sendClick(b.fn.vishnu.JSON.stringify(a),function(){})},
eventInactive:function(){this.Event.Counter[this.Event.INACTIVE]++;this.Event.Counter[this.Event.INACTIVE]>this.initData.events[this.Event.INACTIVE].maxcount&&(this.Event.Counter[this.Event.INACTIVE]=1);this.sendEvent(this.Event.INACTIVE,{count:this.Event.Counter[this.Event.INACTIVE]});this.Event.clearInactiveTimer();this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.INACTIVE,this.Event.Counter[this.Event.INACTIVE])},eventClick:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.CLICK]&&
this.initData.events[this.Event.CLICK].enabled&&!(2>this.Event.timer)){this.resetTimerClick&&window.clearTimeout(this.resetTimerClick);var a=this;this.resetTimerClick=window.setTimeout(function(){a.Event.reset(a.Event,a.Event.CLICK)},this.initData.events[this.Event.CLICK].resetTimeout);this.Event.Counter[this.Event.CLICK]++;this.Event.Counter[this.Event.CLICK]>this.initData.events[this.Event.CLICK].maxcount&&(this.Event.Counter[this.Event.CLICK]=1);this.sendEvent(this.Event.CLICK,{count:this.Event.Counter[this.Event.CLICK]});
this.Event.clearInactiveTimer();this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.CLICK,this.Event.Counter[this.Event.CLICK])}},eventMouse:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.MOUSE]&&this.initData.events[this.Event.MOUSE].enabled&&!(2>this.Event.timer)){this.resetTimerMouse&&window.clearTimeout(this.resetTimerMouse);var a=this;this.resetTimerMouse=window.setTimeout(function(){a.Event.reset(a.Event,a.Event.MOUSE)},this.initData.events[this.Event.MOUSE].resetTimeout);
this.Event.Counter[this.Event.MOUSE]++;this.Event.Counter[this.Event.MOUSE]>this.initData.events[this.Event.MOUSE].maxcount&&(this.Event.Counter[this.Event.MOUSE]=1);this.sendEvent(this.Event.MOUSE,{count:this.Event.Counter[this.Event.MOUSE]});this.Event.clearInactiveTimer();this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.MOUSE_MOVE,this.Event.Counter[this.Event.MOUSE])}},sendUserAction:function(a){this.sendEvent(this.Event.ACTION,a);this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.ACTION,a)},sendRate:function(a){this.Net.sendRate(this.getUUID(),
this.getCUID(),a);this.Vishnu.track(["_trackEvent","Inf","Rate",a]);this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.RATING_SENT,a)}};b.fn.vishnu.View=function(a){this.Vishnu=a};b.fn.vishnu.View.prototype={Vishnu:null,Cookie:null,History:null,template:'<div id="vishnu-view"></div><div id="vishnu-close"></div><div id="vishnu-response"><div id="vishnu-response-wrap"><div id="vishnu-response-text"></div></div></div><div id="vishnu-request"><textarea id="vishnu-input" spellcheck="false"></textarea><button id="vishnu-send"></button></div>',
idView:"#vishnu-view",idSend:"#vishnu-send",idInput:"#vishnu-input",idClose:"#vishnu-close",idRate:"#vishnu-rate",idButton:"#vishnu-button",idResponseText:"#vishnu-response-text",container:null,callbacks:null,baseUrl:".",noCharacter:!1,flashAvailable:!1,flashSrc:"",flashID:"vishnu-flash",animationMask:"/i/anim_#.png",animationTimer:null,animationDurations:{},defaultAnimationDuration:1E3,smoothAnimation:!1,gagsEnabled:!1,gagTimer:null,gagTimeout:4E4,gagAnimations:[],visible:!1,defaultInputText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441",
init:function(a){try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(this.flashAvailable=!0)}catch(d){this.flashAvailable=null!==navigator.plugins&&navigator.plugins["Shockwave Flash"]&&9<=navigator.plugins["Shockwave Flash"].description.split(" ")[2].split(".")[0]}this.Cookie||(this.Cookie=this.Vishnu.getCookie());this.History||(this.History=this.Vishnu.getHistory());this.container||(this.container=this.Vishnu.Target);this.flashID+=this.Vishnu.number;for(var c in a)c in this&&(this[c]=a[c]);
this.visible=this.Cookie.hasCookie("visible")?parseInt(this.Cookie.getCookie("visible")):this.visible;var e=this;this.Vishnu.on(b.fn.vishnu.VishnuEvent.RESPONSE,function(a,b){e.setResponseText(b)})},isFlashEnabled:function(){return this.flashAvailable&&this.flashSrc},draw:function(){this.container.html(this.template);this.noCharacter||b(this.idView,this.container).html(this.getAnimationBox());var a=this;b(this.idView,this.container).mousemove(function(){a.Vishnu.getModel().eventMouse()}).click(function(){a.Vishnu.getModel().eventClick()});
b(this.idSend,this.container).click(function(){a._sendRequest()});var d=this.defaultInputText;b(this.idInput,this.container).keypress(function(c){b(this).val()===d&&(b(this).val(""),b(this).removeClass("placeholder-default"));13===c.keyCode&&(c.preventDefault(),a._sendRequest());a.Vishnu.trigger(b.fn.vishnu.VishnuEvent.USER_ACTIVITY)}).val(d).addClass("placeholder-default").click(function(){b(this).val()===d&&(b(this).val(""),b(this).removeClass("placeholder-default"))}).focus();b(this.idClose,this.container).click(function(){a.hideVishnu()});
b(this.idButton).click(function(){a.visible?a.hideVishnu():a.showVishnu()});this.gagsEnabled&&(this.gagTimer=window.setTimeout(function(){a._playGag()},this.gagTimeout));this.isFlashEnabled()&&(-1<navigator.userAgent.indexOf("YaBrowser")||-1<navigator.userAgent.indexOf("OPR"))?this.container.css("opacity",1):this.isFlashEnabled()&&-1<navigator.userAgent.indexOf("Chrome")&&this.container.css("opacity",0.99);this.visible?this.showVishnu(!0):this.container.hide();this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.DRAW)},
_sendRequest:function(){var a=b(this.idInput,this.container).val();a&&a!==this.defaultInputText&&(this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.REQUEST,a.split('"').join("'")),b(this.idInput,this.container).hide().val("").show().focus())},getAnimationBox:function(){return this.isFlashEnabled()?'<object id="'+this.flashID+'" name="'+this.flashID+'" width="100%" height="100%" type="application/x-shockwave-flash" data="'+this.getFlashSource()+'"> <param name="wmode" value="transparent"/> <param name="allowScript" value="always"/> <param name="allowScriptAccess" value="always"/> <param name="flashVars" value="playAnimation=playAnimation"/> <param name="movie" value="'+
this.getFlashSource()+'"/> </object>':'<img src="'+this.getAnimationURL(0)+'" alt="" />'},getFlash:function(){return window[this.flashID]?window[this.flashID]:document[this.flashID]},getAnimationURL:function(a){return this.baseUrl+this.animationMask.replace("#",a)},getFlashSource:function(){return this.baseUrl+this.flashSrc},hideVishnu:function(){this.visible&&(this.container.fadeOut(200),b(this.idButton).removeClass("selected"),this.visible=!1,this.Cookie.setCookie("visible",0),this.Vishnu.track(["_trackEvent",
"Inf","Hide"]),this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.HIDE))},showVishnu:function(a){a="undefined"===typeof a?!1:a;if(!this.visible||a){var d=this;this.container.fadeIn(200,function(){d.container.show()});b(this.idButton).addClass("selected");this.visible=!0;this.Cookie.setCookie("visible",1);a||this.Vishnu.track(["_trackEvent","Inf","Show"]);this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.SHOW)}},setResponseText:function(a){var b=a.text.value;/href="event:/gim.test(b)&&(this.Vishnu.track(["_trackEvent",
"Inf","Response link show"+(a.isEvent?" (Event)":"")]),this.Cookie.getCookie("chat_link")||(this.Cookie.setCookie("chat_link","1",365),this.Vishnu.track(["_trackEvent","Inf","Chat with link"])));b=this.replaceMarks(b);this.setText(b);this.addMarkListeners(a);a.animation&&a.animation.type&&this.playAnimation(a.animation);a.navigation&&a.navigation.url&&(this.Cookie.setCookie("navigation",1),window.top.location.href=a.navigation.url);if(0>a.text.status){var c=this;window.setTimeout(function(){c.hideVishnu()},
a.text.delay)}},replaceMarks:function(a){return a.replace(/href="event:/gim,'class="vishnulite-click" href="').replace(/<userlink>(.*?)<\/userlink>/gim,"<a class='vishnulite-userlink' href='#'>$1</a>")},addMarkListeners:function(a){var d=a.token,c=this;b(this.idResponseText,this.container).scrollTop(0).find(".vishnulite-userlink").click(function(){c.Vishnu.trigger(b.fn.vishnu.VishnuEvent.REQUEST,b(this).text());c.Vishnu.track(["_trackEvent","Inf","Userlink click",b(this).text()]);return!1}).end().find(".vishnulite-click").click(function(){c.Vishnu.trigger(b.fn.vishnu.VishnuEvent.LINK_CLICK,
d);c.Vishnu.track(["_trackEvent","Inf","Link click"+(a&&a.isEvent?" (Event)":""),b(this).attr("href")]);c.Cookie.getCookie("chat_click")||(c.Cookie.setCookie("chat_click","1",365),c.Vishnu.track(["_trackEvent","Inf","Chat with click"]))}).each(function(){c.Vishnu.track(["_trackEvent","Inf","Link show"+(a.isEvent?" (Event)":""),b(this).attr("href")])})},setText:function(a){b(this.idResponseText,this.container).html(a)},playAnimation:function(a){if(!this.noCharacter)if(this.isFlashEnabled())try{this.getFlash().playAnimation(a.type)}catch(b){}else this._playAnimation(a.type)},
_playAnimation:function(a){if(!this.noCharacter){if(this.animationTimer)return!1;var d=this.animationDurations&&this.animationDurations[a]?this.animationDurations[a]:this.defaultAnimationDuration;this.smoothAnimation?(b(this.idView+" img",this.container).clone().addClass("vishnu-smooth-animation").attr("src",this.getAnimationURL(a)).appendTo(b(this.idView,this.container)).hide(),b(this.idView+" img.vishnulite-smooth-animation",this.container).fadeIn(200)):b(this.idView+" img",this.container).attr("src",
this.getAnimationURL(a));var c=this;this.animationTimer=window.setTimeout(function(){c._stopAnimation()},d);return!0}},_stopAnimation:function(){this.animationTimer=null;this.smoothAnimation?b(this.idView+" img.vishnulite-smooth-animation",this.container).fadeOut(200,function(){b(this).remove()}):b(this.idView+" img",this.container).attr("src",this.getAnimationURL(0))},_playGag:function(){if(!this.noCharacter&&(this.gagTimer=null,this.gagAnimations.length)){var a=this.gagAnimations[Math.floor(Math.random()*
this.gagAnimations.length)];this.playAnimation({type:a});var b=this;this.gagTimer=window.setTimeout(function(){b._playGag()},b.gagTimeout)}}};b.fn.vishnu.Rate=function(a){this.Vishnu=a};b.fn.vishnu.Rate.prototype={Vishnu:null,container:null,view:null,answered:!1,shown:!1,defaultThanksText:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e!",template:'<div id="vishnu-rate"><div id="vishnu-rate-text">\u041f\u043e\u043c\u043e\u0433 \u043b\u0438 \u0432\u0430\u043c \u043e\u0442\u0432\u0435\u0442?</div><div id="vishnu-rate-yes"></div><div id="vishnu-rate-no"></div><div id="vishnu-rate-close"></div><div id="vishnu-rate-thanks"></div><div id="vishnu-rate-details">&mdash; <a href="#" rel="3">\u042f \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u043b(-\u0430) \u043f\u0440\u043e \u0434\u0440\u0443\u0433\u043e\u0435</a><br />&mdash; <a href="#" rel="2">\u042f \u043d\u0435 \u043f\u043e\u043d\u044f\u043b(-\u0430) \u043e\u0442\u0432\u0435\u0442</a><br />&mdash; <a href="#" rel="1">\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0440\u0435\u0448\u0438\u043b \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443</a></div></div>',
idRate:"#vishnu-rate",idRateClose:"#vishnu-rate-close",idRateYes:"#vishnu-rate-yes",idRateNo:"#vishnu-rate-no",idRateDetails:"#vishnu-rate-details",idRateThanks:"#vishnu-rate-thanks",closeTimeout:5E3,init:function(a){for(var d in a)d in this&&(this[d]=a[d]);var c=this;this.Vishnu.on(b.fn.vishnu.VishnuEvent.RESPONSE,function(a,b){c.process(b)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.RATE,function(a,b){c.Vishnu.Model.sendRate(b)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.RATING_RESPONSE,function(a,b){c.showThanks(b)});
this.Vishnu.on(b.fn.vishnu.VishnuEvent.DRAW,function(a){c.draw()})},draw:function(){this.container||(this.container=this.Vishnu.Target);this.container.append(b(this.template));var a=this;b(this.idRateClose,this.container).click(function(){a.close()});b(this.idRateYes,this.container).click(function(){a.answered||(a.answered=!0,a.Vishnu.trigger(b.fn.vishnu.VishnuEvent.RATE,5))});b(this.idRateNo,this.container).click(function(){a.answered||(a.Vishnu.track(["_trackEvent","Inf","Rate","No"]),a.showDetails())});
b(this.idRateDetails+" a",this.container).click(function(d){d.preventDefault();a.answered||(a.answered=!0,a.Vishnu.trigger(b.fn.vishnu.VishnuEvent.RATE,b(this).attr("rel")))})},process:function(a){a.text.showRate?(this.shown&&this.close(),this.show()):this.shown&&this.close()},show:function(){this.shown=!0;this.answered=!1;b(this.idRate,this.container).show();this.Vishnu.track(["_trackEvent","Inf","Rate","Show"])},close:function(){b(this.idRate,this.container).hide();b(this.idRateThanks,this.container).html("").hide();
b(this.idRateDetails,this.container).hide();this.shown=this.answered=!1},showThanks:function(a){text="undefined"!==typeof a&&"undefined"!==typeof a.text&&0<a.text.value.length?a.text.value:this.defaultThanksText;text=this.Vishnu.getView().replaceMarks(text);a.animation&&a.animation.type&&this.Vishnu.getView().playAnimation(a.animation);b(this.idRateDetails,this.container).is(":visible")&&b(this.idRateDetails,this.container).hide();b(this.idRateThanks,this.container).html(text).show();var d=this,c=
a.token;b(this.idRateThanks,this.container).find(".vishnulite-userlink").click(function(){d.Vishnu.trigger(b.fn.vishnu.VishnuEvent.REQUEST,b(this).text());d.Vishnu.track(["_trackEvent","Inf","Rate userlink click",b(this).text()]);return!1}).end().find(".vishnulite-click").click(function(){d.Vishnu.trigger(b.fn.vishnu.VishnuEvent.LINK_CLICK,c);d.Vishnu.track(["_trackEvent","Inf","Rate link click",b(this).attr("href")])}).each(function(){d.Vishnu.track(["_trackEvent","Inf","Rate link show",b(this).attr("href")])});
setTimeout(function(){d.close()},this.closeTimeout)},showDetails:function(){b(this.idRateDetails,this.container).show()}};b.fn.vishnu.History=function(a){this.historyName="vishnu"+a.number+".history";this.Vishnu=a};b.fn.vishnu.History.prototype={length:20,historyName:"",Vishnu:null,useServerStorage:!1,useFlashStorage:!1,useLocalStorage:!1,flashStorageLocation:"./FlashStorage.swf",flashStorageID:"FlashStorage",history:null,init:function(a){for(var d in a)d in this&&(this[d]=a[d]);if(this.useServerStorage||
this.useFlashStorage||this.useLocalStorage){var c=this;this.flashStorageID+=this.Vishnu.number;this.historyName+="["+this.Vishnu.getModel().uuid+"]";this.Vishnu.on(b.fn.vishnu.VishnuEvent.DRAW,function(a){c.draw()});this.Vishnu.on(b.fn.vishnu.VishnuEvent.REQUEST,function(a,b){c.request(b)});this.Vishnu.on(b.fn.vishnu.VishnuEvent.RESPONSE,function(a,b){c.response(b)})}},get:function(){this.history||this.load();return this.history},load:function(){(this.history=this._load())&&this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.HISTORY_LOADED,
[this.history]);return this.history},_load:function(){if(this.useFlashStorage&&this.isFlashStorageAvailable())try{return this.parse(decodeURIComponent(this.getFlashStorage().getData(this.historyName)))}catch(a){this.getFlashStorage().setData(this.historyName,"")}if(this.useLocalStorage&&this.isLocalStorageAvailable())try{return this.parse(localStorage.getItem(this.historyName))}catch(b){}return[]},onLoad:function(a){a&&(this.history=b.toArray(b.parseJSON(a)));this.Vishnu.trigger(b.fn.vishnu.VishnuEvent.HISTORY_LOADED,
[this.history])},draw:function(){this.useFlashStorage&&(this.container||(this.container=this.Vishnu.Target),this.container.append('<object id="'+this.flashStorageID+'" name="'+this.flashStorageID+'" width="1px" height="1px" type="application/x-shockwave-flash" data="'+this.flashStorageLocation+'"> <param name="wmode" value="transparent"/> <param name="allowScript" value="always"/> <param name="allowScriptAccess" value="always"/> <param name="flashVars" value="isDebugger='+(this.Vishnu.debugMode?"true":
"false")+'"/> <param name="movie" value="'+this.flashStorageLocation+'"/> </object>'))},request:function(a){var b=this.get();b.push({user:a});b.length>this.length&&b.splice(0,b.length-this.length);this.save(b)},response:function(a){var b=this.get();b&&0<b.length&&b[b.length-1].inf&&b[b.length-1].inf.replace(/<\/?[^>]+>/g,"")===a.text.value.replace(/<\/?[^>]+>/g,"")||(b.push({inf:a.text.value}),b.length>this.length&&b.splice(0,b.length-this.length),this.save(b))},save:function(a){this.history=a;this.useFlashStorage&&
this.isFlashStorageAvailable()&&this.getFlashStorage().setData(this.historyName,encodeURIComponent(b.fn.vishnu.JSON.stringify(a)));this.useLocalStorage&&this.isLocalStorageAvailable()&&localStorage.setItem(this.historyName,b.fn.vishnu.JSON.stringify(a))},getFlashStorage:function(){return window[this.flashStorageID]?window[this.flashStorageID]:document[this.flashStorageID]},parse:function(a){var d=b.parseJSON(a);if(!("object"==typeof d&&d instanceof Array))throw Error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u0440\u0430\u0441\u043f\u0430\u0440\u0441\u0438\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432: "+
a);return d},isFlashStorageAvailable:function(){try{return null!==this.getFlashStorage()&&"true"==this.getFlashStorage().available()}catch(b){return!1}},isLocalStorageAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(b){return!1}}}})(jQuery);
(function(b){b.fn.vishnu.uuid="88ea147f-2949-42b2-b9c8-00971870d770";b.fn.vishnu.Model.prototype.hideEvent=null;b.fn.vishnu.Model.prototype.hideTimeout=0;b.fn.vishnu.settings[b.fn.vishnu.uuid]={Tracker:{account:0>window.location.href.indexOf("/debug/")&&0>window.location.href.indexOf("/site-test.")?"UA-39462030-12":""},Model:{hideEvent:null,hideTimeout:45E3},View:{baseUrl:"https://biz.nanosemantics.ru/static/custom/hh/v3g/"},Net:{type:b.fn.vishnu.ConnectionType.SYNC,url:0>window.location.href.indexOf("/debug/")&&
0>window.location.href.indexOf("/site-test.")?"https://biz.nanosemantics.ru/api/2.1/json/":"http://biz-debug.nanosemantics.ru/api/2.1/json/"},Rate:{enabled:!0}};var a=b.fn.vishnu.Vishnu.prototype.init;b.fn.vishnu.Vishnu.prototype.init=function(d){var c=this;this.on("draw",function(){b(c.getView().idResponseText,c.getView().container).jScrollPane({verticalDragMinHeight:30,verticalDragMaxHeight:30});var a=c.getModel();a.hideEvent||(a.hideEvent=new b.fn.vishnu.Event);a.hideEvent.initInactiveTimer(function(){b(c.getView().idInput,
c.getView().container).is(":focus")?a.hideEvent.clearInactiveTimer():c.getView().hideVishnu()},a.hideTimeout)});this.on("user-activity",function(){c.getModel().hideEvent.clearInactiveTimer()});this.on("request",function(){c.getModel().hideEvent.clearInactiveTimer()});this.on("response",function(){c.getModel().hideEvent.clearInactiveTimer()});this.on("rate",function(){c.getModel().hideEvent.clearInactiveTimer()});this.on("show",function(){window.parent.document.getElementById("ivishnu").style.display=
"block";b(c.getView().idResponseText,c.getView().container).data("jsp")&&b(c.getView().idResponseText,c.getView().container).data("jsp").reinitialise();c.getModel().hideEvent&&c.getModel().hideEvent.clearInactiveTimer()});this.on("hide",function(){setTimeout(function(){window.parent.document.getElementById("ivishnu").style.display="none"},200)});var e=window.parent.document.getElementById("vishnu-button"),u=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;c.show();return!1};e.attachEvent?
e.attachEvent("onclick",u):e.addEventListener("click",u,!1);a.apply(this,arguments)};b.fn.vishnu.View.prototype.setText=function(a){b(this.idResponseText,this.container).data("jsp").getContentPane().html("<p>"+a+"</p>");b(this.idResponseText,this.container).data("jsp").reinitialise()};b.fn.vishnu.Rate.prototype.process=function(b){b.text.showRate?(this.shown&&this.close(!0),this.show()):this.shown&&this.close()};b.fn.vishnu.Rate.prototype.show=function(){this.shown=!0;this.answered=!1;b(this.idRate,
this.container).height(0).show();this.updateHeight();this.Vishnu.track(["_trackEvent","Inf","Rate","Show"])};b.fn.vishnu.Rate.prototype.close=function(a){var c=this;b(this.idRate,this.container).animate({height:0},a?0:400,function(){b(c.idRate,c.container).hide();b(c.idRateThanks,c.container).html("").hide();b(c.idRateDetails,c.container).hide();b(c.Vishnu.getView().idResponseText,c.container).data("jsp").reinitialise()});this.shown=this.answered=!1;b(this.Vishnu.getView().idResponseText,this.container).animate({height:parseInt(b(this.Vishnu.getView().idResponseText,
this.container).css("max-height"))},a?0:400)};b.fn.vishnu.Rate.prototype.showThanks=function(a){text="undefined"!==typeof a&&"undefined"!==typeof a.text&&0<a.text.value.length?a.text.value:this.defaultThanksText;var c=this;a=0;b(this.idRateDetails,this.container).is(":visible")&&(a=b(this.idRateDetails,this.container)[0].scrollHeight-b(this.idRateThanks,this.container)[0].scrollHeight-12,b(this.idRateDetails,this.container).hide());b(this.idRateThanks,this.container).html(text).show();this.updateHeight(a);
setTimeout(function(){c.close()},this.closeTimeout)};b.fn.vishnu.Rate.prototype.showDetails=function(){b(this.idRateDetails,this.container).show();this.updateHeight()};b.fn.vishnu.Rate.prototype.updateHeight=function(a){var c=this;"undefined"===typeof a&&(a=0);b(this.idRate,this.container).animate({height:b(c.idRate,c.container)[0].scrollHeight-a});b(this.Vishnu.getView().idResponseText,this.container).animate({height:parseInt(b(c.Vishnu.getView().idResponseText,c.container).css("max-height"))-(b(c.idRate,
c.container)[0].scrollHeight-a)},function(){b(c.Vishnu.getView().idResponseText,c.container).data("jsp").reinitialise()})}})(jQuery);
(function(b,a,d){b.fn.jScrollPane=function(c){function e(c,e){function C(a){var oa,pa,e,n,p,q=!1,k=!1;f=a;if(h===d)n=c.scrollTop(),p=c.scrollLeft(),c.css({overflow:"hidden",padding:0}),m=c.innerWidth()+O,l=c.innerHeight(),c.width(m),h=b('<div class="jspPane" />').css("padding",qa).append(c.children()),g=b('<div class="jspContainer" />').css({width:m+"px",height:l+"px"}).append(h).appendTo(c);else{c.css("width","");q=f.stickToBottom&&wa();k=f.stickToRight&&xa();if(e=c.innerWidth()+O!=m||c.outerHeight()!=
l)m=c.innerWidth()+O,l=c.innerHeight(),g.css({width:m+"px",height:l+"px"});if(!e&&ra==v&&h.outerHeight()==t){c.width(m);return}ra=v;h.css("width","");c.width(m);g.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}h.css("overflow","auto");v=a.contentWidth?a.contentWidth:h[0].scrollWidth;t=h[0].scrollHeight;h.css("overflow","");ia=v/m;aa=t/l;z=1<aa;if((A=1<ia)||z){c.addClass("jspScrollable");if(a=f.maintainPosition&&(r||s))oa=G(),pa=H();V();ya();za();a&&(R(k?v-m:oa,!1),I(q?t-l:pa,!1));Aa();
Ba();Ca();f.enableKeyboardNavigation&&Da();f.clickOnTrack&&Ea();Fa();f.hijackInternalLinks&&Ga()}else c.removeClass("jspScrollable"),h.css({top:0,width:g.width()-O}),g.unbind(ja),h.find(":input,a").unbind("focus.jsp"),c.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),sa();f.autoReinitialise&&!S?S=setInterval(function(){C(f)},f.autoReinitialiseDelay):!f.autoReinitialise&&S&&clearInterval(S);n&&c.scrollTop(0)&&I(n,!1);p&&c.scrollLeft(0)&&R(p,!1);c.trigger("jsp-initialised",
[A||z])}function V(){z&&(g.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />'))),ba=g.find(">.jspVerticalBar"),D=ba.find(">.jspTrack"),w=D.find(">.jspDrag"),f.showArrows&&(W=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",J(0,-1)).bind("click.jsp",T),X=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",
J(0,1)).bind("click.jsp",T),f.arrowScrollOnHover&&(W.bind("mouseover.jsp",J(0,-1,W)),X.bind("mouseover.jsp",J(0,1,X))),ta(D,f.verticalArrowPositions,W,X)),K=l,g.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){K-=b(this).outerHeight()}),w.hover(function(){w.addClass("jspHover")},function(){w.removeClass("jspHover")}).bind("mousedown.jsp",function(a){b("html").bind("dragstart.jsp selectstart.jsp",T);w.addClass("jspActive");var c=a.pageY-w.position().top;b("html").bind("mousemove.jsp",
function(a){P(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",ua);return!1}),Q())}function Q(){D.height(K+"px");r=0;ka=f.verticalGutter+D.outerWidth();h.width(m-ka-O);try{0===ba.position().left&&h.css("margin-left",ka+"px")}catch(a){}}function ya(){A&&(g.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />'))),
ca=g.find(">.jspHorizontalBar"),E=ca.find(">.jspTrack"),x=E.find(">.jspDrag"),f.showArrows&&(Y=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",J(-1,0)).bind("click.jsp",T),Z=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",J(1,0)).bind("click.jsp",T),f.arrowScrollOnHover&&(Y.bind("mouseover.jsp",J(-1,0,Y)),Z.bind("mouseover.jsp",J(1,0,Z))),ta(E,f.horizontalArrowPositions,Y,Z)),x.hover(function(){x.addClass("jspHover")},function(){x.removeClass("jspHover")}).bind("mousedown.jsp",
function(a){b("html").bind("dragstart.jsp selectstart.jsp",T);x.addClass("jspActive");var c=a.pageX-x.position().left;b("html").bind("mousemove.jsp",function(a){U(a.pageX-c,!1)}).bind("mouseup.jsp mouseleave.jsp",ua);return!1}),B=g.innerWidth(),va())}function va(){g.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){B-=b(this).outerWidth()});E.width(B+"px");s=0}function za(){if(A&&z){var a=E.outerHeight(),c=D.outerWidth();K-=a;b(ca).find(">.jspCap:visible,>.jspArrow").each(function(){B+=
b(this).outerWidth()});B-=c;l-=c;m-=a;E.parent().append(b('<div class="jspCorner" />').css("width",a+"px"));Q();va()}A&&h.width(g.outerWidth()-O+"px");t=h.outerHeight();aa=t/l;A&&(L=Math.ceil(1/ia*B),L>f.horizontalDragMaxWidth?L=f.horizontalDragMaxWidth:L<f.horizontalDragMinWidth&&(L=f.horizontalDragMinWidth),x.width(L+"px"),M=B-L,la(s));z&&(N=Math.ceil(1/aa*K),N>f.verticalDragMaxHeight?N=f.verticalDragMaxHeight:N<f.verticalDragMinHeight&&(N=f.verticalDragMinHeight),w.height(N+"px"),F=K-N,ma(r))}
function ta(a,b,c,d){var e="before",f="after";"os"==b&&(b=/Mac/.test(navigator.platform)?"after":"split");b==e?f=b:b==f&&(e=b,b=c,c=d,d=b);a[e](c)[f](d)}function J(a,b,c){return function(){Ha(a,b,this,c);this.blur();return!1}}function Ha(a,c,d,e){d=b(d).addClass("jspActive");var n,p,q=!0,g=function(){0!==a&&k.scrollByX(a*f.arrowButtonSpeed);0!==c&&k.scrollByY(c*f.arrowButtonSpeed);p=setTimeout(g,q?f.initialDelay:f.arrowRepeatFreq);q=!1};g();n=e?"mouseout.jsp":"mouseup.jsp";e=e||b("html");e.bind(n,
function(){d.removeClass("jspActive");p&&clearTimeout(p);p=null;e.unbind(n)})}function Ea(){sa();z&&D.bind("mousedown.jsp",function(a){if(a.originalTarget===d||a.originalTarget==a.currentTarget){var c=b(this),e=c.offset(),y=a.pageY-e.top-r,n,p=!0,q=function(){var b=c.offset(),b=a.pageY-b.top-N/2,d=l*f.scrollPagePercent,e=F*d/(t-l);if(0>y)r-e>b?k.scrollByY(-d):P(b);else if(0<y)r+e<b?k.scrollByY(d):P(b);else{g();return}n=setTimeout(q,p?f.initialDelay:f.trackClickRepeatFreq);p=!1},g=function(){n&&clearTimeout(n);
n=null;b(document).unbind("mouseup.jsp",g)};q();b(document).bind("mouseup.jsp",g);return!1}});A&&E.bind("mousedown.jsp",function(a){if(a.originalTarget===d||a.originalTarget==a.currentTarget){var c=b(this),e=c.offset(),y=a.pageX-e.left-s,n,g=!0,q=function(){var b=c.offset(),b=a.pageX-b.left-L/2,d=m*f.scrollPagePercent,e=M*d/(v-m);if(0>y)s-e>b?k.scrollByX(-d):U(b);else if(0<y)s+e<b?k.scrollByX(d):U(b);else{h();return}n=setTimeout(q,g?f.initialDelay:f.trackClickRepeatFreq);g=!1},h=function(){n&&clearTimeout(n);
n=null;b(document).unbind("mouseup.jsp",h)};q();b(document).bind("mouseup.jsp",h);return!1}})}function sa(){E&&E.unbind("mousedown.jsp");D&&D.unbind("mousedown.jsp")}function ua(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");w&&w.removeClass("jspActive");x&&x.removeClass("jspActive")}function P(a,b){z&&(0>a?a=0:a>F&&(a=F),b===d&&(b=f.animateScroll),b?k.animate(w,"top",a,ma):(w.css("top",a),ma(a)))}function ma(a){a===d&&(a=w.position().top);g.scrollTop(0);
r=a;var b=0===r,e=r==F;a=-(a/F)*(t-l);if(da!=b||ea!=e)da=b,ea=e,c.trigger("jsp-arrow-change",[da,ea,fa,ga]);f.showArrows&&(W[b?"addClass":"removeClass"]("jspDisabled"),X[e?"addClass":"removeClass"]("jspDisabled"));h.css("top",a);c.trigger("jsp-scroll-y",[-a,b,e]).trigger("scroll")}function U(a,b){A&&(0>a?a=0:a>M&&(a=M),b===d&&(b=f.animateScroll),b?k.animate(x,"left",a,la):(x.css("left",a),la(a)))}function la(a){a===d&&(a=x.position().left);g.scrollTop(0);s=a;var b=0===s,e=s==M;a=-(a/M)*(v-m);if(fa!=
b||ga!=e)fa=b,ga=e,c.trigger("jsp-arrow-change",[da,ea,fa,ga]);f.showArrows&&(Y[b?"addClass":"removeClass"]("jspDisabled"),Z[e?"addClass":"removeClass"]("jspDisabled"));h.css("left",a);c.trigger("jsp-scroll-x",[-a,b,e]).trigger("scroll")}function I(a,b){P(a/(t-l)*F,b)}function R(a,b){U(a/(v-m)*M,b)}function ha(a,c,d){var e,n,p=0,q=0,h,u,k;try{e=b(a)}catch(r){return}n=e.outerHeight();a=e.outerWidth();g.scrollTop(0);for(g.scrollLeft(0);!e.is(".jspPane");)if(p+=e.position().top,q+=e.position().left,
e=e.offsetParent(),/^body|html$/i.test(e[0].nodeName))return;e=H();h=e+l;p<e||c?u=p-f.verticalGutter:p+n>h&&(u=p-l+n+f.verticalGutter);u&&I(u,d);p=G();u=p+m;q<p||c?k=q-f.horizontalGutter:q+a>u&&(k=q-m+a+f.horizontalGutter);k&&R(k,d)}function G(){return-h.position().left}function H(){return-h.position().top}function wa(){var a=t-l;return 20<a&&10>a-H()}function xa(){var a=v-m;return 20<a&&10>a-G()}function Ba(){g.unbind(ja).bind(ja,function(a,b,c,e){a=s;b=r;k.scrollBy(c*f.mouseWheelSpeed,-e*f.mouseWheelSpeed,
!1);return a==s&&b==r})}function T(){return!1}function Aa(){h.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(a){ha(a.target,!1)})}function Da(){function a(){var b=s,c=r;switch(e){case 40:k.scrollByY(f.keyboardSpeed,!1);break;case 38:k.scrollByY(-f.keyboardSpeed,!1);break;case 34:case 32:k.scrollByY(l*f.scrollPagePercent,!1);break;case 33:k.scrollByY(-l*f.scrollPagePercent,!1);break;case 39:k.scrollByX(f.keyboardSpeed,!1);break;case 37:k.scrollByX(-f.keyboardSpeed,!1)}return d=b!=s||
c!=r}var e,d,y=[];A&&y.push(ca[0]);z&&y.push(ba[0]);h.focus(function(){c.focus()});c.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(c){if(c.target===this||y.length&&b(c.target).closest(y).length){var f=s,g=r;switch(c.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:e=c.keyCode;a();break;case 35:I(t-l);e=null;break;case 36:I(0),e=null}d=c.keyCode==e&&f!=s||g!=r;return!d}}).bind("keypress.jsp",function(b){b.keyCode==e&&a();return!d});f.hideFocus?(c.css("outline",
"none"),"hideFocus"in g[0]&&c.attr("hideFocus",!0)):(c.css("outline",""),"hideFocus"in g[0]&&c.attr("hideFocus",!1))}function Fa(){if(location.hash&&1<location.hash.length){var a,c,e=escape(location.hash.substr(1));try{a=b("#"+e+', a[name="'+e+'"]')}catch(d){return}a.length&&h.find(e)&&(0===g.scrollTop()?c=setInterval(function(){0<g.scrollTop()&&(ha(a,!0),b(document).scrollTop(g.position().top),clearInterval(c))},50):(ha(a,!0),b(document).scrollTop(g.position().top)))}}function Ga(){b(document.body).data("jspHijack")||
(b(document.body).data("jspHijack",!0),b(document.body).delegate("a[href*=#]","click",function(c){var e=this.href.substr(0,this.href.indexOf("#")),d=location.href,f;-1!==location.href.indexOf("#")&&(d=location.href.substr(0,location.href.indexOf("#")));if(e===d){e=escape(this.href.substr(this.href.indexOf("#")+1));f;try{f=b("#"+e+', a[name="'+e+'"]')}catch(g){return}f.length&&(e=f.closest(".jspScrollable"),d=e.data("jsp"),d.scrollToElement(f,!0),e[0].scrollIntoView&&(d=b(a).scrollTop(),f=f.offset().top,
(f<d||f>d+b(a).height())&&e[0].scrollIntoView()),c.preventDefault())}}))}function Ca(){var a,b,c,e,d,f=!1;g.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(g){g=g.originalEvent.touches[0];a=G();b=H();c=g.pageX;e=g.pageY;d=!1;f=!0}).bind("touchmove.jsp",function(g){if(f){g=g.originalEvent.touches[0];var h=s,u=r;k.scrollTo(a+c-g.pageX,b+e-g.pageY);d=d||5<Math.abs(c-g.pageX)||5<Math.abs(e-g.pageY);return h==s&&u==r}}).bind("touchend.jsp",function(a){f=
!1}).bind("click.jsp-touchclick",function(a){if(d)return d=!1})}var f,k=this,h,m,l,g,v,t,ia,aa,z,A,w,F,r,x,M,s,ba,D,ka,K,N,W,X,ca,E,B,L,Y,Z,S,qa,O,ra,da=!0,fa=!0,ea=!1,ga=!1,na=c.clone(!1,!1).empty(),ja=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";qa=c.css("paddingTop")+" "+c.css("paddingRight")+" "+c.css("paddingBottom")+" "+c.css("paddingLeft");O=(parseInt(c.css("paddingLeft"),10)||0)+(parseInt(c.css("paddingRight"),10)||0);b.extend(k,{reinitialise:function(a){a=b.extend({},f,a);C(a)},
scrollToElement:function(a,b,c){ha(a,b,c)},scrollTo:function(a,b,c){R(a,c);I(b,c)},scrollToX:function(a,b){R(a,b)},scrollToY:function(a,b){I(a,b)},scrollToPercentX:function(a,b){R(a*(v-m),b)},scrollToPercentY:function(a,b){I(a*(t-l),b)},scrollBy:function(a,b,c){k.scrollByX(a,c);k.scrollByY(b,c)},scrollByX:function(a,b){var c=(G()+Math[0>a?"floor":"ceil"](a))/(v-m);U(c*M,b)},scrollByY:function(a,b){var c=(H()+Math[0>a?"floor":"ceil"](a))/(t-l);P(c*F,b)},positionDragX:function(a,b){U(a,b)},positionDragY:function(a,
b){P(a,b)},animate:function(a,b,c,e){var d={};d[b]=c;a.animate(d,{duration:f.animateDuration,easing:f.animateEase,queue:!1,step:e})},getContentPositionX:function(){return G()},getContentPositionY:function(){return H()},getContentWidth:function(){return v},getContentHeight:function(){return t},getPercentScrolledX:function(){return G()/(v-m)},getPercentScrolledY:function(){return H()/(t-l)},getIsScrollableH:function(){return A},getIsScrollableV:function(){return z},getContentPane:function(){return h},
scrollToBottom:function(a){P(F,a)},hijackInternalLinks:b.noop,destroy:function(){var a=H(),b=G();c.removeClass("jspScrollable").unbind(".jsp");c.replaceWith(na.append(h.children()));na.scrollTop(a);na.scrollLeft(b);S&&clearInterval(S)}});C(e)}c=b.extend({},b.fn.jScrollPane.defaults,c);b.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){c[this]=c[this]||c.speed});return this.each(function(){var a=b(this),d=a.data("jsp");d?d.reinitialise(c):(b("script",a).filter('[type="text/javascript"],:not([type])').remove(),
d=new e(a,c),a.data("jsp",d))})};b.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:d,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,
trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);
(function(b){function a(a){var c=a||window.event,d=[].slice.call(arguments,1),C=0,V=0,Q=0;a=b.event.fix(c);a.type="mousewheel";c.wheelDelta&&(C=c.wheelDelta/120);c.detail&&(C=-c.detail/3);Q=C;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(Q=0,V=-1*C);void 0!==c.wheelDeltaY&&(Q=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(V=-1*c.wheelDeltaX/120);d.unshift(a,C,V,Q);return(b.event.dispatch||b.event.handle).apply(this,d)}var d=["DOMMouseScroll","mousewheel"];if(b.event.fixHooks)for(var c=d.length;c;)b.event.fixHooks[d[--c]]=
b.event.mouseHooks;b.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var b=d.length;b;)this.addEventListener(d[--b],a,!1);else this.onmousewheel=a},teardown:function(){if(this.removeEventListener)for(var b=d.length;b;)this.removeEventListener(d[--b],a,!1);else this.onmousewheel=null}};b.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
$(function(){var b="",a=window.parent.location.host.split(".");2<a.length&&(b=a[a.length-3]);$(".vishnu-container").vishnu({Model:{params:{region:b}}})});